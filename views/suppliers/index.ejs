<%- include('../partials/header') %>

    <main class="container">

        <!-- FORM LOGIN nếu chưa đăng nhập -->
        <% if (!currentUser) { %>
            <div class="login-box">
                <h2>Đăng nhập để quản lý sản phẩm</h2>
                <form action="/login" method="POST" class="login-form">
                    <input type="text" name="username" placeholder="Tên đăng nhập" required>
                    <input type="password" name="password" placeholder="Mật khẩu" required>
                    <button type="submit">Đăng nhập</button>
                </form>
                <p class="text-center">Chưa có tài khoản? <a href="/register">Đăng ký</a></p>
            </div>
            <% } %>

                <!-- FORM FILTER sản phẩm -->
                <form method="GET" action="/" class="search-form">
                    <select name="supplier">
            <option value="">-- Tất cả nhà cung cấp --</option>
            <% suppliers.forEach(s => { %>
                <option value="<%= s._id %>" <%= selectedSupplier == s._id ? 'selected' : '' %>><%= s.name %></option>
            <% }) %>
        </select>
                    <input type="text" name="q" value="<%= q %>" placeholder="Tìm kiếm sản phẩm">
                    <button>Tìm kiếm</button>
                    <% if (currentUser) { %>
                        <a class="btn" href="/products/new">Thêm sản phẩm</a>
                        <a class="btn" href="/suppliers/new">Thêm nhà cung cấp</a>
                        <% } %>
                </form>

                <!-- BẢNG SẢN PHẨM -->
                <h2>Danh sách sản phẩm</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tên</th>
                            <th>Giá</th>
                            <th>Số lượng</th>
                            <th>Nhà cung cấp</th>
                            <th>Mã nhà cung cấp</th>
                            <% if (currentUser) { %>
                                <th>Hành động</th>
                                <% } %>
                        </tr>
                    </thead>
                    <tbody>
                        <% products.forEach(p => { %>
                            <tr>
                                <td>
                                    <%= p.name %>
                                </td>
                                <td>
                                    <%= p.price %>
                                </td>
                                <td>
                                    <%= p.quantity %>
                                </td>
                                <td>
                                    <%= p.supplierId ? p.supplierId.name : '' %>
                                </td>
                                <td>
                                    <%= p.supplierId ? p.supplierId.code : '' %>
                                </td>
                                <% if (currentUser) { %>
                                    <td>
                                        <a href="/products/<%= p._id %>/edit" class="btn btn-small">Edit</a>
                                        <form method="POST" action="/products/<%= p._id %>?_method=DELETE" style="display:inline">
                                            <button class="btn btn-small btn-danger">Delete</button>
                                        </form>
                                    </td>
                                    <% } %>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

                <!-- BẢNG NHÀ CUNG CẤP -->
                <h2>Danh sách nhà cung cấp</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tên công ty</th>
                            <th>Mã nhà cung cấp</th>
                            <th>Địa chỉ</th>
                            <th>Điện thoại</th>
                            <% if (currentUser) { %>
                                <th>Hành động</th>
                                <% } %>
                        </tr>
                    </thead>
                    <tbody>
                        <% suppliers.forEach(s => { %>
                            <tr>
                                <td>
                                    <%= s.name %>
                                </td>
                                <td>
                                    <%= s.code %>
                                </td>
                                <td>
                                    <%= s.address %>
                                </td>
                                <td>
                                    <%= s.phone %>
                                </td>
                                <% if (currentUser) { %>
                                    <td>
                                        <a href="/suppliers/<%= s._id %>/edit" class="btn btn-small">Edit</a>
                                        <form method="POST" action="/suppliers/<%= s._id %>?_method=DELETE" style="display:inline">
                                            <button class="btn btn-small btn-danger">Delete</button>
                                        </form>
                                    </td>
                                    <% } %>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

    </main>

    <%- include('../partials/footer') %>