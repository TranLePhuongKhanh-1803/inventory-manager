<%- include('partials/header') %>

    <main class="container">

        <!-- FORM FILTER -->
        <form method="GET" action="/" class="search-form">
            <select name="supplier">
            <option value="">-- Tất cả nhà cung cấp --</option>
            <% suppliers.forEach(s => { %>
                <option value="<%= s._id %>" <%= selectedSupplier.toString() === s._id.toString() ? 'selected' : '' %>>
                    <%= s.name %>
                </option>
            <% }) %>
        </select>

            <input type="text" name="q" value="<%= q %>" placeholder="Tìm kiếm sản phẩm">
            <button type="submit">Tìm kiếm</button>

            <% if (currentUser) { %>
                <a class="btn" href="/products/new">Thêm sản phẩm</a>
                <% } %>
        </form>

        <!-- BẢNG SẢN PHẨM -->
        <h2>Danh sách sản phẩm</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Tên</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Nhà cung cấp</th>
                    <th>Mã nhà cung cấp</th>
                    <% if (currentUser) { %>
                        <th>Hành động</th>
                        <% } %>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(p => { %>
                    <tr>
                        <td>
                            <%= p.name %>
                        </td>
                        <td>
                            <%= p.price %>
                        </td>
                        <td>
                            <%= p.quantity %>
                        </td>
                        <td>
                            <%= p.supplierId ? p.supplierId.name : '' %>
                        </td>
                        <td>
                            <%= p.supplierId ? p.supplierId.code : '' %>
                        </td>
                        <% if (currentUser) { %>
                            <td>
                                <a href="/products/<%= p._id %>/edit" class="btn btn-small">Edit</a>
                                <form method="POST" action="/products/<%= p._id %>?_method=DELETE" style="display:inline">
                                    <button class="btn btn-small btn-danger">Delete</button>
                                </form>
                            </td>
                            <% } %>
                    </tr>
                    <% }) %>
            </tbody>
        </table>

        <!-- BẢNG NHÀ CUNG CẤP -->
        <h2>Danh sách nhà cung cấp</h2>
        <% if (currentUser) { %>
            <a class="btn" href="/suppliers/new">Thêm nhà cung cấp</a>
            <% } %>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tên công ty</th>
                            <th>Địa chỉ</th>
                            <th>Điện thoại</th>
                            <th>Mã công ty</th>
                            <% if (currentUser) { %>
                                <th>Hành động</th>
                                <% } %>
                        </tr>
                    </thead>
                    <tbody>
                        <% suppliers.forEach(s => { %>
                            <tr>
                                <td>
                                    <%= s.name %>
                                </td>
                                <td>
                                    <%= s.address %>
                                </td>
                                <td>
                                    <%= s.phone %>
                                </td>
                                <td>
                                    <%= s.code || 'Tự sinh' %>
                                </td>
                                <% if (currentUser) { %>
                                    <td>
                                        <a href="/suppliers/<%= s._id %>/edit" class="btn btn-small">Edit</a>
                                        <form method="POST" action="/suppliers/<%= s._id %>?_method=DELETE" style="display:inline">
                                            <button class="btn btn-small btn-danger">Delete</button>
                                        </form>
                                    </td>
                                    <% } %>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

    </main>

    <%- include('partials/footer') %>